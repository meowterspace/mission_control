<html>
	<head>

		<title>Main</title>
		<!-- INCLUDE THE SOCKETIO LIBS VIA CDN -->
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.4.8/socket.io.min.js"></script>
		<!-- INCLUDE THE JQUERY LIBRARIES VIA CDN -->
		<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
		<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

		<!-- INCLUDE THE BOOTSTRAP LIBRARIES VIA CDN -->
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
		<script src="resources/js/three.min.js"></script>
		<script src='resources/js/navball.js'></script>
		<style type="text/css">
				body {
					background-color: #c4c4c4;
					margin: 0px;
					height: 100%;
				}
				#win1 {
					width: 400px;
					height: 600px;
				}
				#win-FDAI {
					width: 400px;
					height: 400px;
					margin: 0;
				}
				.panel {
					position: absolute;
					clear: both;
					display: none;
				}
				#canvas {
					width: 100%;
					height: 100%;
					
				}

		</style>
		
		<script>
			var FDAI_rendered = 0;
		</script>

		<script>


		/* This makes #winx draggable only by handle(class .handle)
		with a change in opacity on event and ensures most recently dragged
		has the highest z-index  */
		var zIndex = 1;
		$(function() {

			$("div[id*='win']").draggable({
				containment: "window",
				scroll: false,
				handle: $(".handle"),
				opacity: 0.8,
				start: function(event, ui) {
					$(this).css("z-index", ++zIndex);

				}
			});
		});

		/* Function for changing css attribute display to true.
		On show increases z-index to be the highest of all windows
			to prevent displacement */
		function showModal(id) {
			var win = document.getElementById(id);
			$(win).css("z-index", ++zIndex);
			$(win).show();
			if (id=='win-fdai' && FDAI_rendered >= 0) {
				render_navball();
				FDAI_rendered = 1;
			}
		};

		/* Function for hiding the modal */
		function hideModal(id) {
			var win = document.getElementById(id);
			$(win).hide();
		};


		</script>

	</head>

	<body>

<script type="text/javascript">
$(document).ready(function() {
  var socket = io.connect('http://127.0.0.1:5000');
  
  socket.on('connect', function() {
    socket.send('User has connected!');
  });
  
  socket.on('message', function(msg) {
  	
  	// UPDATE PAGE DATA HERE

  	//document.getElementById('time').innerHTML = 'Time ('+msg.zone+'): '+msg.time;
  	var readout; 
  	document.getElementById('serv').innerHTML = msg.serv;
  	readout = readout + '<p>p_acc: '+String(msg.p_acc)+'</p>';
  	readout = readout + '<p>p_ang: '+String(msg.p_ang)+'</p>';
  	readout = readout + '<p>p_fue: '+String(msg.p_fue)+'</p>';
  	readout = readout + '<p>p_orb: '+String(msg.p_orb)+'</p>';
  	readout = readout + '<p>p_pos: '+String(msg.p_pos)+'</p>';
  	readout = readout + '<p>p_sta: '+String(msg.p_sta)+'</p>';
  	readout = readout + '<p>p_thm: '+String(msg.p_thm)+'</p>';
  	readout = readout + '<p>p_vel: '+String(msg.p_vel)+'</p>';
  	readout = readout + '<p>serv: '+String(msg.serv)+'</p>';
  	readout = readout + '<p>time: '+String(msg.time)+'</p>';
  	readout = readout + '<p>uuid: '+String(msg.uuid)+'</p>';
  	readout = readout + '<p>zone: '+String(msg.zone)+'</p>';
	document.getElementById('readout').innerHTML = readout;

  	document.getElementById('serv').innerHTML = msg.serv;
  	if (FDAI_rendered == 1) {
  		FDAI_rendered = FDAI_rendered + 1;
  	} else if (FDAI_rendered ==2) {
    	cube.rotation.x = msg.angle[0];
    };
    socket.send(msg.uuid);
    console.log(msg);
  });
 
});
</script>


		<nav class="navbar navbar-default">
			<div class="container-fluid">
				<ul class="nav navbar-nav">
					<li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">Telemetry<span class="caret"></span></a>
					<ul class="dropdown-menu">
						<li><a href="javascript:showModal('win1')">T1</a></li>
						<li><a href="javascript:showModal('win-fdai')">FDAI</a></li>
						<li><a href="#">T3</a></li>
					</ul>
				</li>
			</ul>
			<div style="top:5px; float:right; position: relative;">
				<span id='serv' style="font-weight:bold; font-size:25px;">OFFINE</span>
			</div>
		</div>
	</nav>
	<div id="win1" class="col-3 panel panel-default">
		<div class="handle panel-heading">readout
			<button type="button" class="close" aria-label="Close" onclick="hideModal('win1')">
			<span aria-hidden="true">&times;</span>
			</button>
		</div>
		<div class="panel-body">
			<span id="readout">OFFINE</span>
		</div>
	</div>

	<div id="win-fdai" class="col-2 panel panel-danger">
		<div class="handle panel-heading">FDAI
			<button type="button" class="close" aria-label="Close" onclick="hideModal('win-fdai')">
			<span aria-hidden="true">&times;</span>
			</button>
		</div>
		<div class="panel-body"><div id='canvas'></div></div>
	</div>
</body>
